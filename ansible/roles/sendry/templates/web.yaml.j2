# Sendry Web configuration
# Generated by Ansible - DO NOT EDIT MANUALLY

server:
  listen_addr: "{{ sendry_web_listen }}"
  tls:
    enabled: false
{% if sendry_web_allowed_ips %}
  allowed_ips:
{% for ip in sendry_web_allowed_ips %}
    - "{{ ip }}"
{% endfor %}
{% endif %}

database:
  path: "{{ sendry_web_data_dir }}/app.db"

auth:
  local_enabled: {{ sendry_web_local_auth_enabled | lower }}
  session_secret: "{{ sendry_web_session_secret }}"
  session_ttl: {{ sendry_web_session_ttl }}
{% if sendry_web_oidc_enabled %}

  oidc:
    enabled: true
    provider: {{ sendry_web_oidc_provider }}
    client_id: "{{ sendry_web_oidc_client_id }}"
    client_secret: "{{ sendry_web_oidc_client_secret }}"
    issuer_url: "{{ sendry_web_oidc_issuer_url }}"
    redirect_url: "{{ sendry_web_oidc_redirect_url }}"
    scopes:
{% for scope in sendry_web_oidc_scopes %}
      - {{ scope }}
{% endfor %}
{% if sendry_web_oidc_allowed_groups %}
    allowed_groups:
{% for group in sendry_web_oidc_allowed_groups %}
      - "{{ group }}"
{% endfor %}
{% endif %}
{% endif %}

sendry:
  servers:
{% if sendry_web_servers %}
{% for server in sendry_web_servers %}
    - name: "{{ server.name }}"
      base_url: "{{ server.base_url }}"
      api_key: "{{ server.api_key }}"
      env: "{{ server.env | default('prod') }}"
{% endfor %}
{% else %}
    - name: "local"
      base_url: "http://127.0.0.1{{ sendry_api_listen }}"
      api_key: "{{ sendry_api_key }}"
      env: "prod"
{% endif %}

  multi_send:
    strategy: {{ sendry_web_multi_send_strategy }}
{% if sendry_web_multi_send_weights %}
    weights:
{% for name, weight in sendry_web_multi_send_weights.items() %}
      {{ name }}: {{ weight }}
{% endfor %}
{% endif %}
{% if sendry_web_multi_send_domain_affinity %}
    domain_affinity:
{% for domain, server in sendry_web_multi_send_domain_affinity.items() %}
      "{{ domain }}": "{{ server }}"
{% endfor %}
{% endif %}
    failover:
      enabled: {{ sendry_web_multi_send_failover_enabled | lower }}
      max_retries: {{ sendry_web_multi_send_failover_max_retries }}

logging:
  level: "{{ sendry_log_level }}"
  format: "{{ sendry_log_format }}"
