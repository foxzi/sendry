{{define "content"}}
<div class="page-header">
    <div>
        <h1>Send Test Email</h1>
        <p class="text-muted">Template: {{.Template.Name}}</p>
    </div>
    <a href="/templates/{{.Template.ID}}" class="btn btn-secondary">Back to Template</a>
</div>

<div class="grid-2">
    <div class="card">
        <div class="card-header">
            <h2>Send Test</h2>
        </div>
        <div class="card-body">
            {{if .Servers}}
            <form method="POST" action="/templates/{{.Template.ID}}/test">
                <div class="form-group">
                    <label for="server">Server</label>
                    <select name="server" id="server" class="form-control" required>
                        <option value="">Select server...</option>
                        {{range .Servers}}
                        <option value="{{.Name}}">{{.Name}} ({{.Env}})</option>
                        {{end}}
                    </select>
                    <span class="form-help">Choose a server to send through</span>
                </div>

                <div class="form-group">
                    <label for="from">From</label>
                    <input type="email" name="from" id="from" class="form-control" required placeholder="sender@example.com">
                    <span class="form-help">Sender email address</span>
                </div>

                <div class="form-group">
                    <label for="to">To</label>
                    <input type="email" name="to" id="to" class="form-control" required placeholder="recipient@example.com">
                    <span class="form-help">Your email to receive the test</span>
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Send Test Email</button>
                </div>
            </form>
            {{else}}
            <p class="empty-state">No servers configured. Add servers in config to send test emails.</p>
            {{end}}
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h2>Template Info</h2>
        </div>
        <div class="card-body">
            <dl class="details-list">
                <dt>Subject</dt>
                <dd><code>{{.Template.Subject}}</code></dd>

                <dt>Version</dt>
                <dd>v{{.Template.CurrentVersion}}</dd>

                <dt>Has HTML</dt>
                <dd>{{if .Template.HTML}}Yes{{else}}No{{end}}</dd>

                <dt>Has Text</dt>
                <dd>{{if .Template.Text}}Yes{{else}}No{{end}}</dd>
            </dl>

            <div class="mt-3">
                <a href="/templates/{{.Template.ID}}/preview" class="btn btn-sm" target="_blank">Preview Template</a>
            </div>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h2>Notes</h2>
    </div>
    <div class="card-body">
        <ul>
            <li>Test emails will have <code>[TEST]</code> prefix in subject</li>
            <li>Global variables will be substituted if defined</li>
            <li>For sandbox servers, email will be captured instead of sent</li>
            <li>Check server queue/sandbox to verify delivery</li>
        </ul>
    </div>
</div>
{{end}}
