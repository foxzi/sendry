{{define "content"}}
<div class="page-header">
    <h1>Jobs</h1>
</div>

<div class="card">
    <div class="card-header">
        <form class="filter-form" method="get" action="/jobs">
            <select name="status" class="input">
                <option value="">All Status</option>
                <option value="draft" {{if eq .Status "draft"}}selected{{end}}>Draft</option>
                <option value="scheduled" {{if eq .Status "scheduled"}}selected{{end}}>Scheduled</option>
                <option value="running" {{if eq .Status "running"}}selected{{end}}>Running</option>
                <option value="paused" {{if eq .Status "paused"}}selected{{end}}>Paused</option>
                <option value="completed" {{if eq .Status "completed"}}selected{{end}}>Completed</option>
                <option value="failed" {{if eq .Status "failed"}}selected{{end}}>Failed</option>
                <option value="cancelled" {{if eq .Status "cancelled"}}selected{{end}}>Cancelled</option>
            </select>
            <button type="submit" class="btn">Filter</button>
            {{if .Status}}
            <a href="/jobs" class="btn btn-secondary">Clear</a>
            {{end}}
        </form>
    </div>
    <div class="card-body">
        {{if .Jobs}}
        <table class="table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Campaign</th>
                    <th>Status</th>
                    <th>Progress</th>
                    <th>Sent/Total</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {{range .Jobs}}
                <tr>
                    <td><a href="/jobs/{{.Job.ID}}">{{slice .Job.ID 0 8}}...</a></td>
                    <td><a href="/campaigns/{{.Job.CampaignID}}">{{.Job.CampaignName}}</a></td>
                    <td><span class="badge badge-{{.Job.Status}}">{{.Job.Status}}</span></td>
                    <td>
                        <div class="progress" style="width: 100px">
                            <div class="progress-bar" style="width: {{.Progress}}%"></div>
                        </div>
                    </td>
                    <td>{{.Stats.Sent}} / {{.Stats.Total}}</td>
                    <td>{{.Job.CreatedAt.Format "2006-01-02 15:04"}}</td>
                    <td class="actions">
                        <a href="/jobs/{{.Job.ID}}" class="btn btn-sm">View</a>
                    </td>
                </tr>
                {{end}}
            </tbody>
        </table>

        {{if gt .TotalPages 1}}
        <div class="pagination">
            {{if gt .Page 1}}
            <a href="/jobs?page={{sub .Page 1}}{{if .Status}}&status={{.Status}}{{end}}" class="btn btn-sm">&laquo; Prev</a>
            {{end}}
            <span class="pagination-info">Page {{.Page}} of {{.TotalPages}} ({{.Total}} total)</span>
            {{if lt .Page .TotalPages}}
            <a href="/jobs?page={{add .Page 1}}{{if .Status}}&status={{.Status}}{{end}}" class="btn btn-sm">Next &raquo;</a>
            {{end}}
        </div>
        {{end}}
        {{else}}
        <div class="empty-state">
            <p>No jobs found</p>
            <p class="text-muted">Jobs are created when you send a campaign</p>
        </div>
        {{end}}
    </div>
</div>
{{end}}
